
# 🗺️ ウェブベース マップ探索・捕獲ゲーム

PythonのFlaskフレームワークとSQLiteデータベースを使用して開発された、ブラウザで遊べるRPG風マップ探索・捕獲ゲームです。
プレイヤーはマップを探索し、モンスター（またはオブジェクト）を捕獲するためのアイテムを入手・使用しながら、経験値を獲得してレベルアップを目指します。

## ⚙️ 使用技術

| カテゴリ | 技術 | 詳細 |
| --- | --- | --- |
| **バックエンド** | Python | メイン言語 |
| | Flask | ウェブアプリケーションフレームワーク |
| | SQLAlchemy | ORM (Object Relational Mapper) |
| **データベース** | SQLite | データの永続化 (`game.db`) |
| **フロントエンド** | HTML / CSS / JS | ユーザーインターフェースとゲームロジック |
| | Bootstrap 5.3.3 | レスポンシブUI、モーダル、スタイル設定 |
| **API** | RESTful API | ゲーム状態更新、宝箱、捕獲処理のエンドポイント |

## 📁 システムアーキテクチャとファイル構成

本プロジェクトは、Flaskの**アプリケーションファクトリパターン**と**ブループリント**を採用しており、機能ごとにファイルを分割することで高い保守性と拡張性を確保しています。

### ディレクトリ構造概観

```text
project-root/
├── app.py                  # アプリケーションのエントリーポイント
├── game/                   # Flaskアプリケーションパッケージ本体
│   ├── __init__.py         # アプリ初期化（ファクトリ関数、DB設定）
│   ├── models.py           # データベースモデル定義 (ORM)
│   ├── utils.py            # ゲームロジック・計算処理
│   └── routes/             # APIルート定義（ブループリント）
│       ├── state.py        # 状態管理API
│       ├── chest.py        # 宝箱API
│       └── capture.py      # 捕獲API
├── templates/
│   └── index.html          # メイン画面のHTMLテンプレート
├── static/                 # 静的ファイル
│   ├── css/                # スタイルシート
│   ├── js/                 # フロントエンドJavaScript
│   └── html/               # 動的ロード用HTMLパーツ
└── tools/
    └── migrate_add_level_xp.py # 開発・保守用マイグレーションスクリプト

```

### 詳細な役割定義

#### 1. エントリーポイント (`app.py`)

アプリケーションを実行するための最上位ファイルです。`game/__init__.py` で定義された `create_app()` 関数を呼び出してインスタンスを作成し、Webサーバーを起動します。

#### 2. アプリケーションコア (`game/`)

* **`__init__.py`**: アプリケーションのセットアップを行います。設定（Config）の読み込み、データベース（`db`）の初期化、そしてAPIルート（Blueprints）の登録を一括管理します。
* **`models.py` (データベース定義)**: SQLAlchemyを利用して以下のデータ構造を定義しています。
* `User`: ユーザー認証情報
* `Inventory`: 所持アイテム（縄など）
* `Stats`: プレイヤーステータス（レベル、経験値XP）
* `DexEntry`: 図鑑データ（捕獲記録）


* **`utils.py` (ゲームロジック)**: データベース操作以外の純粋な計算ロジックを担当します。
* 捕獲成功率の計算
* 宝箱の中身の抽選ロジック
* 経験値獲得とレベルアップ判定



#### 3. APIルート定義 (`game/routes/`)

RESTful APIのエンドポイント定義です。フロントエンドからのリクエストを受け取り、`utils.py` のロジックと `models.py` のデータを組み合わせて処理を行います。

* **`state.py`**: プレイヤーの状態（レベル、インベントリなど）を取得・更新します。
* **`chest.py`**: 宝箱を開封する処理。アイテム抽選を行い、インベントリを更新します。
* **`capture.py`**: 捕獲アクションの処理。使用アイテムと対象の強さから成功判定を行い、結果に応じて図鑑や経験値を更新します。

#### 4. フロントエンド (`templates/` & `static/`)

* **`templates/index.html`**: ゲームのメインUI。地図画面、ステータスパネル、モーダルウィンドウなどの骨組みを定義します。
* **`static/`**: `css/` によるBootstrapのカスタマイズや、`js/` によるAPI通信・DOM操作など、ブラウザ側で実行されるアセットを格納しています。

#### 5. 開発ツール (`tools/`)

* **`migrate_add_level_xp.py`**: データベース構造の変更（マイグレーション）用スクリプトです。開発途中で追加された `Stats` モデル（レベル・経験値）のカラムを、既存の `game.db` に反映させるために使用します。

---

## 🎮 ゲームの主な特徴

### マップ探索とシンプルUI

* 地図画面と、インベントリ・ステータスを表示するメニューパネルを分離した見やすいインターフェース。
* 捕獲時のモーダルウィンドウなど、Bootstrapを活用したスムーズな操作感を提供します。

### 捕獲システム

* `utils.py` 内の計算ロジックにより、対象のレベルとレアリティに応じた**捕獲成功率**を算出。
* 以下の3種類のロープ（捕獲アイテム）を使い分けて捕獲に挑戦します：
* 普通の縄 / 銀の縄 / 金の縄



### プレイヤーの成長要素（RPG要素）

* **レベルと経験値（XP）システム**を実装。
* 捕獲成功時にXPを獲得し、一定値でレベルアップします。データは `Stats` モデルを通じてデータベースに永続化されます。
* 宝箱（金・青・赤）を開けることでアイテムを獲得できます。

## 🚀 セットアップと実行方法

### 1. 依存関係のインストール

プロジェクトルートで必要なパッケージをインストールします。

```bash
# 仮想環境の使用を推奨
# pip install -r requirements.txt
# または手動でインストール:
pip install Flask Flask-SQLAlchemy

```

### 2. アプリケーションの実行

初回起動時、データベースファイル（`game.db`）が自動生成されます。

```bash
python app.py

```

### 3. ゲームへのアクセス

ブラウザで以下にアクセスしてください。
[http://127.0.0.1:5000/](http://127.0.0.1:5000/)

---

## 📝 補足：データベースのマイグレーション

`tools/migrate_add_level_xp.py` は、既存のDBにレベル・経験値のカラムを追加するスクリプトです。データ構造を変更した際、必要に応じて実行してください。

```bash
python tools/migrate_add_level_xp.py

```

```

```
